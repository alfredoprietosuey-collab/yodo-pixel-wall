{% extends "base.html" %}
{% block content %}
<section class="grid">
  <div class="card">
    <h1>{{ team["name"] if team else ("Team " ~ team_id) }}</h1>
    {% if team and team["sponsor_name"] %}
      <p class="muted">Presentado por <strong>{{ team["sponsor_name"] }}</strong></p>
    {% endif %}
    {% if team and team["sponsor_claim"] %}
      <p>{{ team["sponsor_claim"] }}</p>
    {% endif %}

    <div class="progress">
      <div class="bar" style="width: {{ team_pct }}%"></div>
    </div>
    <div class="progress_meta">
      <span>{{ team_checkins }} / {{ team_goal }} check-ins</span>
      <strong>{{ team_pct }}%</strong>
    </div>

    {% if not joined %}
      <form id="join-team-form" method="post" action="/api/join-team">
        <input type="hidden" name="team_id" value="{{ team_id }}" />
        <button class="btn primary">Unirme al Team</button>
      </form>
    {% else %}
      <div class="pill">✅ Estás en este Team</div>
    {% endif %}

    <div class="card_inset">
      <h3>Compartir</h3>
      <p class="muted">MVP: botón que copia el link (próximo paso: tarjeta story).</p>
      <button class="btn" id="btn-copy">Copiar link</button>
      <input class="copybox" id="copybox" readonly value="{{ BASE_URL }}/team/{{ team_id }}" />
    </div>
  </div>

  <div class="card">
    <h2>Cómo funciona</h2>
    <ol class="list">
      <li>Entra cada día (10s).</li>
      <li>Haz check‑in.</li>
      <li>Sumas al objetivo público.</li>
      <li>La marca financia agua si se alcanza la meta.</li>
    </ol>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  document.getElementById("btn-copy")?.addEventListener("click", async () => {
    const v = document.getElementById("copybox").value;
    await navigator.clipboard.writeText(v);
    const b = document.getElementById("btn-copy");
    b.textContent = "¡Copiado!";
    setTimeout(()=>b.textContent="Copiar link", 1200);
  });
</script>
{% endblock %}
